<!DOCTYPE html>
<html>
<head>
    <title>Email Scraper</title>
    <style>
        :root {
            --lavender: #b57edc;
            --black: #121212;
            --white: #f5f5f5;
            --orange: #ff7f50;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background-color: var(--black);
            color: var(--lavender);
            transition: background-color 0.3s, color 0.3s;
        }

        body.light-mode {
            background-color: var(--white);
            color: var(--black);
        }

        h1 {
            text-align: center;
        }

        form {
            text-align: center;
            margin-bottom: 30px;
        }

        input[type="text"] {
            padding: 10px;
            width: 300px;
            border: 2px solid var(--lavender);
            background-color: transparent;
            color: inherit;
        }

        body.light-mode input[type="text"] {
            border-color: var(--orange);
        }

        button {
            padding: 10px 20px;
            background-color: var(--lavender);
            color: var(--black);
            border: none;
            cursor: pointer;
        }

        body.light-mode button {
            background-color: var(--orange);
            color: var(--white);
        }

        button:hover {
            opacity: 0.9;
        }

        .results {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            margin: 0 auto;
        }

        body.light-mode .results {
            background-color: rgba(0, 0, 0, 0.05);
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            background: rgba(255, 255, 255, 0.1);
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
        }

        body.light-mode li {
            background: rgba(0, 0, 0, 0.1);
        }

        .download, .fun-fact, .mode-toggle {
            text-align: center;
            margin-top: 20px;
        }

        #loader {
            display: none;
            text-align: center;
            margin: 20px auto;
        }

        .hourglass {
            width: 40px;
            height: 40px;
            border: 6px solid var(--lavender);
            border-top: 6px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        body.light-mode .hourglass {
            border-color: var(--orange);
            border-top: 6px solid transparent;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="mode-toggle">
        <button onclick="toggleMode()">Toggle Light/Dark Mode</button>
    </div>

    <h1>Email Scraper</h1>

    <form id="scrape-form" onsubmit="startStreaming(event)">
        <input type="text" id="keyword" name="keyword" placeholder="Enter keyword..." required>
        <button type="submit">Scrape</button>
    </form>

    <div id="loader"><div class="hourglass"></div></div>

    <div class="fun-fact" id="fun-fact">
        ðŸ’¡ Did you know? Email scraping helps marketers find leads in real-time!
    </div>

    <script>
        const funFacts = [
            "ðŸ’¡ Did you know? Email scraping helps marketers find leads in real-time!",
            "ðŸ’¡ Some scrapers can scan hundreds of pages in minutes!",
            "ðŸ’¡ Avoid scraping login-protected sitesâ€”itâ€™s often against TOS.",
            "ðŸ’¡ Email scraping can help automate your sales funnel!",
            "ðŸ’¡ Domains like 'noreply' are filtered out to reduce junk!"
        ];

        let factIndex = 0;
        setInterval(() => {
            factIndex = (factIndex + 1) % funFacts.length;
            document.getElementById("fun-fact").textContent = funFacts[factIndex];
        }, 30000);

        function toggleMode() {
            document.body.classList.toggle("light-mode");
        }

        function startStreaming(e) {
            e.preventDefault();
            document.getElementById("loader").style.display = "block";
            document.querySelector(".results")?.remove(); // remove old result
            const keyword = document.getElementById("keyword").value;

            const eventSource = new EventSource(`/stream?keyword=${encodeURIComponent(keyword)}`);
            const resultsDiv = document.createElement("div");
            resultsDiv.className = "results";
            resultsDiv.innerHTML = `<h2>Found emails for "${keyword}":</h2><ul id="email-list"></ul>`;
            document.body.appendChild(resultsDiv);

            const emailList = document.getElementById("email-list");

            eventSource.onmessage = function(event) {
                if (event.data === "START") return;

                if (event.data.startsWith("DONE|")) {
                    const filename = event.data.split("|")[1];
                    const downloadDiv = document.createElement("div");
                    downloadDiv.className = "download";
                    downloadDiv.innerHTML = `<a href="/download/${filename}"><button>Download CSV</button></a>`;
                    resultsDiv.appendChild(downloadDiv);
                    document.getElementById("loader").style.display = "none";
                    eventSource.close();
                } else {
                    const li = document.createElement("li");
                    li.textContent = event.data;
                    emailList.appendChild(li);
                }
            };
        }
    </script>
</body>
</html>
